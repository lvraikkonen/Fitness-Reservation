# 健身场馆预约系统数据库设计文档

## 1. 简介
本文档描述了健身场馆预约系统的数据库设计,包括数据库表结构、字段说明以及表之间的关系。该数据库设计旨在满足系统的功能需求,包括用户管理、场馆管理、预约管理、领导预留时间管理等。

## 2. 数据库表设计

### 2.1 用户表(User)

存储系统中的用户信息,包括用户名、密码、邮箱、电话、角色(管理员/普通用户)和是否为领导等。
用于用户身份验证和权限控制。

| 字段名    | 数据类型     | 主键 | 外键 | 非空 | 默认值   | 说明                  |
| --------- | ------------ | ---- | ---- | ---- | -------- | --------------------- |
| UserId    | int          | 是   | 否   | 是   | 自增     | 用户ID                |
| Username  | varchar(50)  | 否   | 否   | 是   | 无       | 用户名                |
| Password  | varchar(100) | 否   | 否   | 是   | 无       | 密码(加密存储)        |
| Email     | varchar(100) | 否   | 否   | 是   | 无       | 电子邮件              |
| Phone     | varchar(20)  | 否   | 否   | 是   | 无       | 电话号码              |
| Role      | varchar(20)  | 否   | 否   | 是   | 'User'   | 角色(管理员/普通用户) |
| IsLeader  | bit          | 否   | 否   | 是   | 0        | 是否为领导            |
| CreatedAt | datetime     | 否   | 否   | 是   | 当前时间 | 创建时间              |
| UpdatedAt | datetime     | 否   | 否   | 是   | 当前时间 | 更新时间              |

### 2.2 个人资料表(Profile)

存储用户的个人资料信息,如全名、部门、喜好的运动类型和时间段等。
与用户表是一对一的关系,通过UserId字段关联。

| 字段名          | 数据类型     | 主键 | 外键 | 非空 | 默认值   | 说明           |
| --------------- | ------------ | ---- | ---- | ---- | -------- | -------------- |
| ProfileId       | int          | 是   | 否   | 是   | 自增     | 个人资料ID     |
| UserId          | int          | 否   | 是   | 是   | 无       | 关联的用户ID   |
| FullName        | varchar(50)  | 否   | 否   | 否   | 无       | 全名           |
| Department      | varchar(50)  | 否   | 否   | 否   | 无       | 部门           |
| PreferredSports | varchar(100) | 否   | 否   | 否   | 无       | 喜好的运动类型 |
| PreferredTime   | varchar(100) | 否   | 否   | 否   | 无       | 喜好的时间段   |
| CreatedAt       | datetime     | 否   | 否   | 是   | 当前时间 | 创建时间       |
| UpdatedAt       | datetime     | 否   | 否   | 是   | 当前时间 | 更新时间       |

### 2.3 运动场馆表(SportVenue)

存储不同类型的运动场馆信息,如篮球馆、足球场等。
包含运动场馆的名称和位置信息。

| 字段名         | 数据类型     | 主键 | 外键 | 非空 | 默认值   | 说明         |
| -------------- | ------------ | ---- | ---- | ---- | -------- | ------------ |
| SportVenueId   | int          | 是   | 否   | 是   | 自增     | 运动场馆ID   |
| SportVenueName | varchar(50)  | 否   | 否   | 是   | 无       | 运动场馆名称 |
| Location       | varchar(100) | 否   | 否   | 是   | 无       | 运动场馆位置 |
| CreatedAt      | datetime     | 否   | 否   | 是   | 当前时间 | 创建时间     |
| UpdatedAt      | datetime     | 否   | 否   | 是   | 当前时间 | 更新时间     |

### 2.4 具体场馆表(Venue)

存储每个运动场馆下的具体场馆信息,如篮球馆1、篮球馆2等。
包含场馆名称、容纳人数、预约须知等信息。
与运动场馆表是多对一的关系,通过SportVenueId字段关联。

| 字段名       | 数据类型    | 主键 | 外键 | 非空 | 默认值   | 说明             |
| ------------ | ----------- | ---- | ---- | ---- | -------- | ---------------- |
| VenueId      | int         | 是   | 否   | 是   | 自增     | 具体场馆ID       |
| SportVenueId | int         | 否   | 是   | 是   | 无       | 关联的运动场馆ID |
| VenueName    | varchar(50) | 否   | 否   | 是   | 无       | 具体场馆名称     |
| Capacity     | int         | 否   | 否   | 是   | 无       | 容纳人数         |
| Notice       | text        | 否   | 否   | 否   | 无       | 预约须知         |
| CreatedAt    | datetime    | 否   | 否   | 是   | 当前时间 | 创建时间         |
| UpdatedAt    | datetime    | 否   | 否   | 是   | 当前时间 | 更新时间         |

### 2.5 设施表(Facility)

存储场馆内的设施信息,如淋浴间、更衣室、储物柜等。
包含设施名称和描述信息。
与具体场馆表是多对一的关系,通过VenueId字段关联。

| 字段名       | 数据类型    | 主键 | 外键 | 非空 | 默认值   | 说明             |
| ------------ | ----------- | ---- | ---- | ---- | -------- | ---------------- |
| FacilityId   | int         | 是   | 否   | 是   | 自增     | 设施ID           |
| VenueId      | int         | 否   | 是   | 是   | 无       | 关联的具体场馆ID |
| FacilityName | varchar(50) | 否   | 否   | 是   | 无       | 设施名称         |
| Description  | text        | 否   | 否   | 否   | 无       | 设施描述         |
| CreatedAt    | datetime    | 否   | 否   | 是   | 当前时间 | 创建时间         |
| UpdatedAt    | datetime    | 否   | 否   | 是   | 当前时间 | 更新时间         |

### 2.6 预约时间段表(ReservationTimeSlot)

存储每个具体场馆在特定日期下可预约的时间段信息。
包含场馆ID、日期、开始时间和结束时间等信息。
与具体场馆表是多对一的关系,通过VenueId字段关联。

| 字段名     | 数据类型 | 主键 | 外键 | 非空 | 默认值   | 说明             |
| ---------- | -------- | ---- | ---- | ---- | -------- | ---------------- |
| TimeSlotId | int      | 是   | 否   | 是   | 自增     | 时间段ID         |
| VenueId    | int      | 否   | 是   | 是   | 无       | 关联的具体场馆ID |
| Date       | date     | 否   | 否   | 是   | 无       | 日期             |
| StartTime  | time     | 否   | 否   | 是   | 无       | 开始时间         |
| EndTime    | time     | 否   | 否   | 是   | 无       | 结束时间         |
| CreatedAt  | datetime | 否   | 否   | 是   | 当前时间 | 创建时间         |
| UpdatedAt  | datetime | 否   | 否   | 是   | 当前时间 | 更新时间         |

### 2.7 预约表(Reservation)

存储用户的预约信息,包括预约的用户、时间段和预约状态等。
与用户表和预约时间段表分别是多对一的关系,通过UserId和TimeSlotId字段关联。

| 字段名        | 数据类型    | 主键 | 外键 | 非空 | 默认值   | 说明           |
| ------------- | ----------- | ---- | ---- | ---- | -------- | -------------- |
| ReservationId | int         | 是   | 否   | 是   | 自增     | 预约ID         |
| UserId        | int         | 否   | 是   | 是   | 无       | 关联的用户ID   |
| TimeSlotId    | int         | 否   | 是   | 是   | 无       | 关联的时间段ID |
| Status        | varchar(20) | 否   | 否   | 是   | '已预约' | 预约状态       |
| CreatedAt     | datetime    | 否   | 否   | 是   | 当前时间 | 创建时间       |
| UpdatedAt     | datetime    | 否   | 否   | 是   | 当前时间 | 更新时间       |

### 2.8 等候列表表(WaitingList)

存储预约被占用时,等候的用户信息。
包含预约ID和等候的用户ID。
与预约表和用户表分别是多对一的关系,通过ReservationId和UserId字段关联。

| 字段名        | 数据类型 | 主键 | 外键 | 非空 | 默认值   | 说明         |
| ------------- | -------- | ---- | ---- | ---- | -------- | ------------ |
| WaitingId     | int      | 是   | 否   | 是   | 自增     | 等候ID       |
| ReservationId | int      | 否   | 是   | 是   | 无       | 关联的预约ID |
| UserId        | int      | 否   | 是   | 是   | 无       | 关联的用户ID |
| CreatedAt     | datetime | 否   | 否   | 是   | 当前时间 | 创建时间     |
| UpdatedAt     | datetime | 否   | 否   | 是   | 当前时间 | 更新时间     |

### 2.9 反馈表(Feedback)

存储用户提交的反馈信息,包括反馈标题、内容和管理员回复等。
与用户表是多对一的关系,通过UserId字段关联。

| 字段名     | 数据类型     | 主键 | 外键 | 非空 | 默认值   | 说明         |
| ---------- | ------------ | ---- | ---- | ---- | -------- | ------------ |
| FeedbackId | int          | 是   | 否   | 是   | 自增     | 反馈ID       |
| UserId     | int          | 否   | 是   | 是   | 无       | 关联的用户ID |
| Title      | varchar(100) | 否   | 否   | 是   | 无       | 反馈标题     |
| Content    | text         | 否   | 否   | 是   | 无       | 反馈内容     |
| Reply      | text         | 否   | 否   | 否   | 无       | 管理员回复   |
| CreatedAt  | datetime     | 否   | 否   | 是   | 当前时间 | 创建时间     |
| UpdatedAt  | datetime     | 否   | 否   | 是   | 当前时间 | 更新时间     |

### 2.10 通知表(Notification)

存储发送给用户的通知信息,包括通知标题、内容、类型和是否已读等。
与用户表是多对一的关系,通过UserId字段关联。

| 字段名         | 数据类型     | 主键 | 外键 | 非空 | 默认值   | 说明         |
| -------------- | ------------ | ---- | ---- | ---- | -------- | ------------ |
| NotificationId | int          | 是   | 否   | 是   | 自增     | 通知ID       |
| UserId         | int          | 否   | 是   | 是   | 无       | 关联的用户ID |
| Title          | varchar(100) | 否   | 否   | 是   | 无       | 通知标题     |
| Content        | text         | 否   | 否   | 是   | 无       | 通知内容     |
| Type           | varchar(20)  | 否   | 否   | 是   | 无       | 通知类型     |
| IsRead         | bit          | 否   | 否   | 是   | 0        | 是否已读     |
| CreatedAt      | datetime     | 否   | 否   | 是   | 当前时间 | 创建时间     |
| UpdatedAt      | datetime     | 否   | 否   | 是   | 当前时间 | 更新时间     |

### 2.11 领导预留时间表(LeaderReservedTime)

存储领导用户预留的时间段信息,包括领导用户ID、场馆ID、预留的星期、开始时间和结束时间等。
与用户表和具体场馆表分别是多对一的关系,通过UserId和VenueId字段关联。

| 字段名         | 数据类型 | 主键 | 外键 | 非空 | 默认值   | 说明               |
| -------------- | -------- | ---- | ---- | ---- | -------- | ------------------ |
| ReservedTimeId | int      | 是   | 否   | 是   | 自增     | 预留时间ID         |
| UserId         | int      | 否   | 是   | 是   | 无       | 关联的领导用户ID   |
| VenueId        | int      | 否   | 是   | 是   | 无       | 关联的具体场馆ID   |
| DayOfWeek      | int      | 否   | 否   | 是   | 无       | 预留时间的星期     |
| StartTime      | time     | 否   | 否   | 是   | 无       | 预留时间的开始时间 |
| EndTime        | time     | 否   | 否   | 是   | 无       | 预留时间的结束时间 |
| CreatedAt      | datetime | 否   | 否   | 是   | 当前时间 | 创建时间           |
| UpdatedAt      | datetime | 否   | 否   | 是   | 当前时间 | 更新时间           |

## 3. 表关系
- Profile表与User表之间是一对一的关系,通过UserId字段关联。
- Venue表与SportVenue表之间是多对一的关系,通过SportVenueId字段关联。
- Facility表与Venue表之间是多对一的关系,通过VenueId字段关联。
- ReservationTimeSlot表与Venue表之间是多对一的关系,通过VenueId字段关联。
- Reservation表与User表之间是多对一的关系,通过UserId字段关联;与ReservationTimeSlot表之间是多对一的关系,通过TimeSlotId字段关联。
- WaitingList表与Reservation表之间是多对一的关系,通过ReservationId字段关联;与User表之间是多对一的关系,通过UserId字段关联。
- Feedback表与User表之间是多对一的关系,通过UserId字段关联。
- Notification表与User表之间是多对一的关系,通过UserId字段关联。
- LeaderReservedTime表与User表之间是多对一的关系,通过UserId字段关联;与Venue表之间是多对一的关系,通过VenueId字段关联。

## 4. 索引设计
- User表的Username字段建立唯一索引,确保用户名的唯一性。
- User表的Email字段建立唯一索引,确保电子邮件的唯一性。
- SportVenue表的SportVenueName字段建立索引,提高运动场馆名称的查询效率。
- Venue表的VenueName字段建立索引,提高具体场馆名称的查询效率。
- ReservationTimeSlot表的Date字段建立索引,提高按日期查询时间段的效率。
- Reservation表的UserId和TimeSlotId字段建立组合索引,提高按用户和时间段查询预约的效率。
- LeaderReservedTime表的UserId和VenueId字段建立组合索引,提高按领导用户和具体场馆查询预留时间的效率。

## 5. 总结
本数据库设计文档详细描述了健身场馆预约系统的数据库表结

## 6. 数据库初始化脚本

`init_db.sql`