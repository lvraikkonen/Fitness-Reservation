# 健身场馆预约系统数据库设计文档

## 1. 简介
本文档描述了健身场馆预约系统的数据库设计,包括数据库表结构、字段说明以及表之间的关系。该数据库设计旨在满足系统的功能需求,包括用户管理、场馆管理、预约管理、领导预留时间管理等。

## 2. 数据库表设计

### 2.1 用户表(user)

存储系统中的用户信息,包括用户名、密码、邮箱、电话、角色(管理员/普通用户)和是否为领导等，还包括用户的喜好运动类型、喜好时间段等。
用于用户身份验证和权限控制。

| 字段名        | 数据类型     | 主键 | 非空 | 默认值 | 说明               |
| ------------- | ------------ | ---- | ---- | ------ | ------------------ |
| id            | SERIAL       | 是   | 是   | 无     | 用户ID,自增主键    |
| username      | VARCHAR(50)  | 否   | 是   | 无     | 用户名,唯一        |
| password      | VARCHAR(100) | 否   | 是   | 无     | 密码,加密存储      |
| email         | VARCHAR(100) | 否   | 是   | 无     | 电子邮件,唯一      |
| phone         | VARCHAR(20)  | 否   | 是   | 无     | 电话号码           |
| role          | SMALLINT     | 否   | 是   | 0      | 角色,0:普通用户,1:管理员 |
| is_leader     | BOOLEAN      | 否   | 是   | false  | 是否为领导         |
| full_name     | VARCHAR(50)  | 否   | 否   | 无     | 全名               |
| department    | VARCHAR(50)  | 否   | 否   | 无     | 部门               |
| preferred_sports | VARCHAR(100) | 否   | 否   | 无     | 喜好的运动类型     |
| preferred_time   | VARCHAR(100) | 否   | 否   | 无     | 喜好的时间段       |
| created_at    | TIMESTAMP    | 否   | 是   | NOW()  | 创建时间           |
| updated_at    | TIMESTAMP    | 否   | 是   | NOW()  | 更新时间           |


### 2.3 运动场馆表(sport_venue)

存储不同类型的运动场馆信息,如篮球馆、足球场等。
包含运动场馆的名称和位置信息。

| 字段名        | 数据类型     | 主键 | 非空 | 默认值 | 说明         |
| ------------- | ------------ | ---- | ---- | ------ | ------------ |
| id            | SERIAL       | 是   | 是   | 无     | 运动场馆ID,自增主键 |
| name          | VARCHAR(50)  | 否   | 是   | 无     | 运动场馆名称,唯一 |
| location      | VARCHAR(100) | 否   | 是   | 无     | 运动场馆位置 |
| created_at    | TIMESTAMP    | 否   | 是   | NOW()  | 创建时间     |
| updated_at    | TIMESTAMP    | 否   | 是   | NOW()  | 更新时间     |

### 2.4 具体场馆表(venue)

存储每个运动场馆下的具体场馆信息,如篮球馆1、篮球馆2等。
包含场馆名称、容纳人数、预约须知等信息。
与运动场馆表是多对一的关系,通过`sport_venue_id`字段关联。

| 字段名        | 数据类型    | 主键 | 非空 | 默认值 | 说明             |
| ------------- | ----------- | ---- | ---- | ------ | ---------------- |
| id            | SERIAL      | 是   | 是   | 无     | 具体场馆ID,自增主键 |
| sport_venue_id | INTEGER     | 否   | 是   | 无     | 所属运动场馆ID,外键 |
| name          | VARCHAR(50) | 否   | 是   | 无     | 具体场馆名称     |
| capacity      | INTEGER     | 否   | 是   | 无     | 容纳人数         |
| status        | ENUM        | 否   | 是   | VenueStatus.OPEN | 场馆状态：OPEN/CLOSED/MAINTENANCE |
| notice        | TEXT        | 否   | 否   | 无     | 预约须知         |
| created_at    | TIMESTAMP   | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP   | 否   | 是   | NOW()  | 更新时间         |

### 2.5 设施表(facility)

存储场馆内的设施信息,如淋浴间、更衣室、储物柜等。
包含设施名称和描述信息。
与具体场馆表是多对一的关系,通过`venue_id`字段关联。

| 字段名        | 数据类型    | 主键 | 非空 | 默认值 | 说明             |
| ------------- | ----------- | ---- | ---- | ------ | ---------------- |
| id            | SERIAL      | 是   | 是   | 无     | 设施ID,自增主键  |
| venue_id      | INTEGER     | 否   | 是   | 无     | 所属具体场馆ID,外键 |
| name          | VARCHAR(50) | 否   | 是   | 无     | 设施名称         |
| description   | TEXT        | 否   | 否   | 无     | 设施描述         |
| created_at    | TIMESTAMP   | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP   | 否   | 是   | NOW()  | 更新时间         |

### 2.6 预约时间段表(reservation_time_slot)

存储每个具体场馆在特定日期下可预约的时间段信息。
包含场馆ID、日期、开始时间和结束时间等信息。
与具体场馆表是多对一的关系,通过`venue_id`字段关联。

| 字段名        | 数据类型    | 主键 | 非空 | 默认值 | 说明             |
| ------------- | ----------- | ---- | ---- | ------ | ---------------- |
| id            | SERIAL      | 是   | 是   | 无     | 时间段ID,自增主键 |
| venue_id      | INTEGER     | 否   | 是   | 无     | 所属具体场馆ID,外键 |
| date          | DATE        | 否   | 是   | 无     | 日期             |
| start_time    | TIME        | 否   | 是   | 无     | 开始时间         |
| end_time      | TIME        | 否   | 是   | 无     | 结束时间         |
| created_at    | TIMESTAMP   | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP   | 否   | 是   | NOW()  | 更新时间         |

### 2.7 预约表(reservation)

存储用户的预约信息,包括预约的用户、时间段和预约状态等。
与用户表和预约时间段表分别是多对一的关系,通过`user_id`和`time_slot_id`字段关联。

| 字段名         | 数据类型    | 主键 | 非空 | 默认值 | 说明             |
| -------------- | ----------- | ---- | ---- | ------ | ---------------- |
| id             | SERIAL      | 是   | 是   | 无     | 预约ID,自增主键  |
| user_id        | INTEGER     | 否   | 是   | 无     | 预约用户ID,外键  |
| time_slot_id   | INTEGER     | 否   | 是   | 无     | 预约时间段ID,外键 |
| status         | ENUM        | 否   | 是   | ReservationStatus.PENDING | 预约状态,ENUM类型 PENDING/CONFIRMED/CANCELLED |
| created_at     | TIMESTAMP   | 否   | 是   | NOW()  | 创建时间         |
| updated_at     | TIMESTAMP   | 否   | 是   | NOW()  | 更新时间         |

### 2.8 等候列表表(waiting_list)

存储预约被占用时,等候的用户信息。
包含预约ID和等候的用户ID。
与预约表和用户表分别是多对一的关系,通过`reservation_id`和`user_id`字段关联。

| 字段名        | 数据类型  | 主键 | 非空 | 默认值 | 说明             |
| ------------- | --------- | ---- | ---- | ------ | ---------------- |
| id            | SERIAL    | 是   | 是   | 无     | 等候ID,自增主键  |
| reservation_id| INTEGER   | 否   | 是   | 无     | 关联的预约ID,外键 |
| user_id       | INTEGER   | 否   | 是   | 无     | 等候用户ID,外键  |
| created_at    | TIMESTAMP | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP | 否   | 是   | NOW()  | 更新时间         |

### 2.9 反馈表(feedback)

存储用户提交的反馈信息,包括反馈标题、内容和管理员回复等。
与用户表是多对一的关系,通过`user_id`字段关联。

| 字段名        | 数据类型     | 主键 | 非空 | 默认值 | 说明             |
| ------------- | ------------ | ---- | ---- | ------ | ---------------- |
| id            | SERIAL       | 是   | 是   | 无     | 反馈ID,自增主键  |
| user_id       | INTEGER      | 否   | 是   | 无     | 反馈用户ID,外键  |
| title         | VARCHAR(100) | 否   | 是   | 无     | 反馈标题         |
| content       | TEXT         | 否   | 是   | 无     | 反馈内容         |
| reply         | TEXT         | 否   | 否   | 无     | 管理员回复       |
| created_at    | TIMESTAMP    | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP    | 否   | 是   | NOW()  | 更新时间         |

### 2.10 通知表(notification)

存储发送给用户的通知信息,包括通知标题、内容、类型和是否已读等。
与用户表是多对一的关系,通过`user_id`字段关联。

| 字段名        | 数据类型     | 主键 | 非空 | 默认值 | 说明             |
| ------------- | ------------ | ---- | ---- | ------ | ---------------- |
| id            | SERIAL       | 是   | 是   | 无     | 通知ID,自增主键  |
| user_id       | INTEGER      | 否   | 是   | 无     | 接收通知的用户ID,外键 |
| title         | VARCHAR(100) | 否   | 是   | 无     | 通知标题         |
| content       | TEXT         | 否   | 是   | 无     | 通知内容         |
| type          | VARCHAR(20)  | 否   | 是   | 无     | 通知类型,ENUM类型 |
| is_read       | BOOLEAN      | 否   | 是   | false  | 是否已读         |
| created_at    | TIMESTAMP    | 否   | 是   | NOW()  | 创建时间         |
| updated_at    | TIMESTAMP    | 否   | 是   | NOW()  | 更新时间         |

### 2.11 领导预留时间表(leader_reserved_time)

存储领导用户预留的时间段信息,包括领导用户ID、场馆ID、预留的星期、开始时间和结束时间等。
与用户表和具体场馆表分别是多对一的关系,通过`user_id`和`venue_id`字段关联。

| 字段名        | 数据类型  | 主键 | 非空 | 默认值 | 说明               |
| ------------- | --------- | ---- | ---- | ------ | ------------------ |
| id            | SERIAL    | 是   | 是   | 无     | 预留时间ID,自增主键 |
| user_id       | INTEGER   | 否   | 是   | 无     | 领导用户ID,外键    |
| venue_id      | INTEGER   | 否   | 是   | 无     | 预留场馆ID,外键    |
| day_of_week   | SMALLINT  | 否   | 是   | 无     | 预留时间的星期     |
| start_time    | TIME      | 否   | 是   | 无     | 预留时间的开始时间 |
| end_time      | TIME      | 否   | 是   | 无     | 预留时间的结束时间 |
| created_at    | TIMESTAMP | 否   | 是   | NOW()  | 创建时间           |
| updated_at    | TIMESTAMP | 否   | 是   | NOW()  | 更新时间           |



## 3. 表关系
- venue表通过sport_venue_id字段与sport_venue表之间是多对一的关系。
- facility表通过venue_id字段与venue表之间是多对一的关系。
- reservation_time_slot表通过venue_id字段与venue表之间是多对一的关系。
- reservation表通过user_id字段与user表之间是多对一的关系,通过time_slot_id字段与reservation_time_slot表之间是多对一的关系。
- waiting_list表通过reservation_id字段与reservation表之间是多对一的关系,通过user_id字段与user表之间是多对一的关系。
- feedback表通过user_id字段与user表之间是多对一的关系。
- notification表通过user_id字段与user表之间是多对一的关系。
- leader_reserved_time表通过user_id字段与user表之间是多对一的关系,通过venue_id字段与venue表之间是多对一的关系。

## 4. 索引设计
- 在user表的username字段和email字段上分别创建唯一索引,确保用户名和电子邮件的唯一性。
- 在sport_venue表的name字段上创建唯一索引,确保运动场馆名称的唯一性。
- 在venue表的name字段上创建索引,提高具体场馆名称的查询效率。
- 在reservation_time_slot表的date字段上创建索引,提高按日期查询时间段的效率。
- 在reservation表的user_id字段和time_slot_id字段上创建组合索引,提高按用户和时间段查询预约的效率。
- 在leader_reserved_time表的user_id字段和venue_id字段上创建组合索引,提高按领导用户和具体场馆查询预留时间的效率。

## 5. 其他说明
- 对于状态、类型等字段,使用ENUM类型可以限制取值范围,提高数据完整性。具体的ENUM值可以根据业务需求进行定义。
- 对于时间相关的字段,使用TIMESTAMP类型可以自动记录时间戳,并且与时区无关。
- 对于需要存储较长文本内容的字段,如notice、description、content等,使用TEXT类型可以满足存储需求。


## 6. 数据库初始化脚本

`init_db.sql`